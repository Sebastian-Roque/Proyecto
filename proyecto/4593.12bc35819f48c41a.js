"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4593],{4593:(C,m,c)=>{c.r(m),c.d(m,{MapPageModule:()=>P});var g=c(177),d=c(4341),s=c(3667),h=c(9384),M=c(467),u=c(8244),e=c(4438);function f(n,r){if(1&n){const o=e.RV6();e.j41(0,"ion-item",1),e.bIt("click",function(){const i=e.eBV(o).$implicit,a=e.XpG(3);return e.Njj(a.selectSuggestion(i))}),e.EFF(1),e.k0s()}if(2&n){const o=r.$implicit;e.R7$(),e.SpI(" ",o.display_name," ")}}function _(n,r){if(1&n&&(e.j41(0,"ion-list"),e.DNE(1,f,2,1,"ion-item",9),e.k0s()),2&n){const o=e.XpG(2);e.R7$(),e.Y8G("ngForOf",o.suggestions)}}function v(n,r){if(1&n){const o=e.RV6();e.j41(0,"div",5)(1,"ion-item")(2,"ion-label",6),e.EFF(3,"Busca una ubicaci\xf3n"),e.k0s(),e.j41(4,"ion-input",7),e.mxI("ngModelChange",function(i){e.eBV(o);const a=e.XpG();return e.DH7(a.searchQuery,i)||(a.searchQuery=i),e.Njj(i)}),e.bIt("ionInput",function(){e.eBV(o);const i=e.XpG();return e.Njj(i.searchChange())}),e.k0s()(),e.DNE(5,_,2,1,"ion-list",8),e.k0s()}if(2&n){const o=e.XpG();e.R7$(4),e.R50("ngModel",o.searchQuery),e.R7$(),e.Y8G("ngIf",o.suggestions.length>0)}}const y=[{path:"",component:(()=>{var n;class r{constructor(t){this.router=t,this.searchQuery="",this.map=null,this.userMarker=null,this.suggestions=[],this.isSearchVisible=!0,this.isLoading=!0}ngOnInit(){setTimeout(()=>{this.initializeMap()},500)}initializeMap(){this.map=u.map("map").setView([51.505,-.09],13),u.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19}).addTo(this.map),this.map.on("click",t=>{this.handleMapClick(t.latlng.lat,t.latlng.lng),this.suggestions=[]}),this.isLoading=!1}searchChange(){var t=this;return(0,M.A)(function*(){if(!t.searchQuery.trim())return void(t.suggestions=[]);const i=`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(t.searchQuery)}&format=json&addressdetails=1&limit=5`;try{const l=yield(yield fetch(i,{headers:{"User-Agent":"MyApp (myemail@example.com)"}})).json();t.suggestions=l.length>0?l:[]}catch(a){console.error("Error al obtener sugerencias:",a),t.suggestions=[]}})()}selectSuggestion(t){const i=parseFloat(t.lat),a=parseFloat(t.lon);this.map?(this.map.setView([i,a],15),this.addMarker(i,a),this.suggestions=[]):console.error("El mapa no est\xe1 inicializado.")}addMarker(t,i){this.map?(this.userMarker&&this.map.removeLayer(this.userMarker),this.userMarker=u.marker([t,i],{draggable:!0}).addTo(this.map),this.userMarker.bindPopup(`<b>Latitud:</b> ${t}, <b>Longitud:</b> ${i}`).openPopup(),this.userMarker.on("click",()=>{this.promptEvaluation(t,i)}),this.userMarker.on("dragend",()=>{var a;const l=null===(a=this.userMarker)||void 0===a?void 0:a.getLatLng();var p;l&&(null===(p=this.userMarker)||void 0===p||p.setPopupContent(`<b>Latitud:</b> ${l.lat}, <b>Longitud:</b> ${l.lng}`).openPopup())})):console.error("El mapa no est\xe1 inicializado.")}promptEvaluation(t,i){confirm("\xbfDeseas agregar una evaluaci\xf3n en esta ubicaci\xf3n?")&&this.router.navigate(["/add-place"],{queryParams:{lat:t,lng:i}})}handleMapClick(t,i){var a=this;return(0,M.A)(function*(){const l=`https://nominatim.openstreetmap.org/reverse?lat=${t}&lon=${i}&format=json`;try{const k=(yield(yield fetch(l,{headers:{"User-Agent":"MyApp (myemail@example.com)"}})).json()).display_name||"Ubicaci\xf3n desconocida";a.addMarker(t,i),u.popup().setLatLng([t,i]).setContent(`<b>${k}</b><br>Latitud: ${t}, Longitud: ${i}`).openOn(a.map)}catch(p){console.error("Error al realizar geocodificaci\xf3n inversa:",p)}})()}toggleSearch(){this.isSearchVisible=!this.isSearchVisible}}return(n=r).\u0275fac=function(t){return new(t||n)(e.rXU(h.Ix))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-map"]],decls:10,vars:1,consts:[["slot","end"],[3,"click"],["name","search-outline","slot","icon-only"],["class","search-container",4,"ngIf"],["id","map",2,"height","calc(100vh - 56px)"],[1,"search-container"],["position","floating"],["placeholder","Escribe una direcci\xf3n",3,"ngModelChange","ionInput","ngModel"],[4,"ngIf"],[3,"click",4,"ngFor","ngForOf"]],template:function(t,i){1&t&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e.EFF(3,"Mapa"),e.k0s(),e.j41(4,"ion-buttons",0)(5,"ion-button",1),e.bIt("click",function(){return i.toggleSearch()}),e.nrm(6,"ion-icon",2),e.k0s()()()(),e.j41(7,"ion-content"),e.DNE(8,v,6,2,"div",3),e.nrm(9,"div",4),e.k0s()),2&t&&(e.R7$(8),e.Y8G("ngIf",i.isSearchVisible))},dependencies:[g.Sq,g.bT,d.BC,d.vS,s.Jm,s.QW,s.W9,s.eU,s.iq,s.$w,s.uz,s.he,s.nf,s.BC,s.ai,s.Gw],styles:['@charset "UTF-8";#mapId[_ngcontent-%COMP%]{height:100%;z-index:0}.leaflet-popup-content-wrapper[_ngcontent-%COMP%]{background:#2a2d3e;color:#d1d5db;border-radius:8px}ion-toolbar[_ngcontent-%COMP%]{--background: var(--ion-color-primary);--color: white}ion-input[_ngcontent-%COMP%]{margin:0 16px}']}),r})()}];let b=(()=>{var n;class r{}return(n=r).\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[h.iI.forChild(y),h.iI]}),r})(),P=(()=>{var n;class r{}return(n=r).\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[g.MD,d.YN,s.bv,b]}),r})()}}]);